const simpleStorageABI = [
  {
    constant: false,
    inputs: [
      {
        name: 'x',
        type: 'uint256'
      }
    ],
    name: 'set',
    outputs: [],
    payable: false,
    stateMutability: 'nonpayable',
    type: 'function',
    signature: '0x60fe47b1'
  },
  {
    constant: true,
    inputs: [],
    name: 'get',
    outputs: [
      {
        name: '',
        type: 'uint256'
      }
    ],
    payable: false,
    stateMutability: 'view',
    type: 'function',
    signature: '0x6d4ce63c'
  }
]
const simpleStorageAddress = '0x9Df18edCD7cDA2b52AB5390f3cee17e59DBEE14D'
const web3 = new Web3('http://localhost:9545')
const simpleStorage = new web3.eth.Contract(
  simpleStorageABI,
  simpleStorageAddress
)

document.addEventListener('DOMContentLoaded', () => {
  const $setData = document.getElementById('setData')
  const $data = document.getElementById('data')
  let accounts = []

  web3.eth.getAccounts().then((_accounts) => {
    accounts = _accounts
  })

  const getData = () => {
    simpleStorage.methods
      .get()
      .call()
      .then((result) => {
        $data.innerHTML = result
      })
  }
  getData()

  $setData.addEventListener('submit', (e) => {
    e.preventDefault()
    const data = e.target.elements[0].value
    simpleStorage.methods.set(data).send({ from: accounts[0] }).then(getData)
  })
})
